generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Candidate {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  title           String
  company         String?
  experienceYears Int
  location        String?
  imageUrl        String?
  about           String?
  workExperience  Json?
  education       Json?
  matchMeta       Json?
  availability    String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model SearchHistory {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String?
  queryText String
  filters   Json?
  results   Int
  credits   Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CreditAccount {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @unique
  balance   Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Shortlisted {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String
  candidateId String
  status      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Campaign {
  id        String      @id @default(auto()) @map("_id") @db.ObjectId
  userId    String
  title     String
  type      String
  status    String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  steps     Step[]
  recipients Recipient[]
}

model Step {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  campaignId String   @db.ObjectId
  campaign   Campaign @relation(fields: [campaignId], references: [id])
  orderIndex Int
  subject    String
  body       String
  waitDays   Int      @default(0)
  fromAddr   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Recipient {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  campaignId String   @db.ObjectId
  campaign   Campaign @relation(fields: [campaignId], references: [id])
  email      String
  name       String?
  status     String
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model AnalyticsEvent {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  campaignId  String?
  recipientId String?
  eventType   String
  timestamp   DateTime @default(now())
  metadata    Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
